{% extends "magazine/base.html" %}
{% block content %}
    <h1><font color="aqua"> Корзина </font></h1>
    <div class="backet"></div>

    <div class="total"> Сумма: <span class="sum"> 0 </span> </div>
    Имя: <input name="name" placeholder="ФИО">
    Телефон: <input name="phone" placeholder="88005353535">
{#    <a id="cart" href="{% url 'cart' %}"> <h1>Show me the money!</h1></a>#}

    <h1 id="cart" class='oplata' onclick="ShowMoney()">Show me the money!</h1>
    {{ form.render }}

<script type="text/javascript">
    $(function(){
        var arr1 = $.cookie('cart');
        if (!arr1) {
             arr1 = '[]';
        }
        var json2 = $.parseJSON(arr1);
        var sum1 = 0;
         $.each(json2, function(index, value) {
             $('.backet').append('<div class="row"><div class="id" style="display:none">'+index+'</div><img src="'+value["img"]+'"><div class="name">'+value["name"]+'</div><div class="price">'+value["price"]+'</div><div class="btn btn-default"> <span class="glyphicon glyphicon-trash"></div></span></div>');
             sum1 = sum1 + parseInt(value['price']);
         });
        $('.total .sum').text(sum1);
        $('.btn').on('click', function(){
            var parent = $(this).parent();
           var obj = parseInt($(this).closest('.row').find('.id').text());
            var arr = $.cookie('cart');
        if (!arr) {
             arr = '[]';
        }
        var json = $.parseJSON(arr);
        var sum = parseInt($('.total .sum').text());
{#        console.log($("#Sonia").attr("href"));#}
{#            console.log(sum);#}

            $.each(json, function(index, value) {
                if (index == obj){
                    sum = sum - parseInt(value['price']);
                    json.splice(index,1);
                }
            });
            $.cookie('cart', JSON.stringify(json), {path: '/'});
            $('.total .sum').text(sum);

            parent.remove();
            $.each($('.id'), function(index, value) {
                $(this).text(index)
            });
        });
    });
    </script>

    <script>
    function ShowMoney() {
        var sum = $('.total .sum').text();
        location.href = '/payment/cart/' + sum + '/';

    }
    </script>
{% endblock %}